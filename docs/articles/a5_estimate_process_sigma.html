<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Estimating process trend variability with bayesdfa • bayesdfa</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Estimating process trend variability with bayesdfa">
<meta property="og:description" content="bayesdfa">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bayesdfa</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.3.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/a1_bayesdfa.html">Overview of the bayesdfa package</a>
    </li>
    <li>
      <a href="../articles/a2_combining_data.html">Combining data with bayesdfa</a>
    </li>
    <li>
      <a href="../articles/a3_covariates.html">Examples of including covariates with bayesdfa</a>
    </li>
    <li>
      <a href="../articles/a4_smooth.html">Examples of fitting smooth trend DFA models</a>
    </li>
    <li>
      <a href="../articles/a5_estimate_process_sigma.html">Estimating process trend variability with bayesdfa</a>
    </li>
    <li>
      <a href="../articles/a6_compositional.html">Fitting compositional dynamic factor models with bayesdfa</a>
    </li>
    <li>
      <a href="../articles/a7_bigdata.html">Examples of fitting DFA models with lots of data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/fate-ewi/bayesdfa/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Estimating process trend variability with
bayesdfa</h1>
                        <h4 data-toc-skip class="author">Eric J. Ward,
Sean C. Anderson, Mary E. Hunsicker, Mike A. Litzow, Luis A. Damiano,
Mark D. Scheuerell, Elizabeth E. Holmes, Nick Tolimieri</h4>
            
            <h4 data-toc-skip class="date">2024-10-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/fate-ewi/bayesdfa/blob/HEAD/vignettes/a5_estimate_process_sigma.Rmd" class="external-link"><code>vignettes/a5_estimate_process_sigma.Rmd</code></a></small>
      <div class="hidden name"><code>a5_estimate_process_sigma.Rmd</code></div>

    </div>

    
    
<p>A constraint of most DFA models is that the latent trends are modeled
as random walks with fixed standard deviations (= 1). We can evaluate
the ability to estimate these parameters in a Bayesian context
below.</p>
<p>Let’s load the necessary packages:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://fate-ewi.github.io/bayesdfa/" class="external-link">bayesdfa</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/rstan/" class="external-link">rstan</a></span><span class="op">)</span></span>
<span><span class="va">chains</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="va">iter</span> <span class="op">=</span> <span class="fl">10</span></span></code></pre></div>
<div class="section level2">
<h2 id="case-1-unequal-trend-variability">Case 1: unequal trend variability<a class="anchor" aria-label="anchor" href="#case-1-unequal-trend-variability"></a>
</h2>
<p>First, let’s simulate some data. We will use the built-in function
<code><a href="../reference/sim_dfa.html">sim_dfa()</a></code>, but normally you would start with your own data.
We will simulate 20 data points from 4 time series, generated from 2
latent processes. For this first dataset, the data won’t include
extremes, and loadings will be randomly assigned (default).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">sim_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_dfa.html">sim_dfa</a></span><span class="op">(</span></span>
<span>  num_trends <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  num_years <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  num_ts <span class="op">=</span> <span class="fl">4</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We’ll tweak the default code though to model slightly different
random walks, with different standard deviations for each trend. We’ll
assume these standard deviations are 0.3 and 0.5, respectively.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">sim_dat</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sim_dat</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Looking at the random walks, we can see the 2nd trend (red dashed
line) is more variable than the black line.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"l"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Response"</span>, xlab <span class="op">=</span> <span class="st">"Time"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="a5_estimate_process_sigma_files/figure-html/simulate-data-plot-1.png" alt="Simulated data, from a model with 2 latent trends and no extremes.\label{fig:simulate-data-plot}" width="528"><p class="caption">
Simulated data, from a model with 2 latent trends and no extremes.
</p>
</div>
<p>Next, we’ll calculate the predicted values of each time series and
add observation error</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_dat</span><span class="op">$</span><span class="va">pred</span> <span class="op">=</span> <span class="va">sim_dat</span><span class="op">$</span><span class="va">Z</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">sim_dat</span><span class="op">$</span><span class="va">x</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">$</span><span class="va">pred</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">$</span><span class="va">pred</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">sim_dat</span><span class="op">$</span><span class="va">y_sim</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="va">sim_dat</span><span class="op">$</span><span class="va">pred</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0.1</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level3">
<h3 id="candidate-models">Candidate models<a class="anchor" aria-label="anchor" href="#candidate-models"></a>
</h3>
<p>Next, we’ll fit a 2-trend DFA model to the simulated time series
using the <code><a href="../reference/fit_dfa.html">fit_dfa()</a></code> function. This default model fixed the
variances of the trends at 1 – and implicitly assumes that they have
equal variance.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_dfa.html">fit_dfa</a></span><span class="op">(</span></span>
<span>  y <span class="op">=</span> <span class="va">sim_dat</span><span class="op">$</span><span class="va">y_sim</span>, num_trends <span class="op">=</span> <span class="fl">2</span>, scale<span class="op">=</span><span class="st">"zscore"</span>,</span>
<span>  iter <span class="op">=</span> <span class="va">iter</span>, chains <span class="op">=</span> <span class="va">chains</span>, thin <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="va">r1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rotate_trends.html">rotate_trends</a></span><span class="op">(</span><span class="va">f1</span><span class="op">)</span></span></code></pre></div>
<p>Next, we’ll fit the model with process errors being estimated – and
assume unequal variances by trend.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_dfa.html">fit_dfa</a></span><span class="op">(</span></span>
<span>  y <span class="op">=</span> <span class="va">sim_dat</span><span class="op">$</span><span class="va">y_sim</span>, num_trends <span class="op">=</span> <span class="fl">2</span>, scale<span class="op">=</span><span class="st">"zscore"</span>, estimate_process_sigma <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  equal_process_sigma <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  iter <span class="op">=</span> <span class="va">iter</span>, chains <span class="op">=</span> <span class="va">chains</span>, thin <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="va">r2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rotate_trends.html">rotate_trends</a></span><span class="op">(</span><span class="va">f2</span><span class="op">)</span></span></code></pre></div>
<p>Third, we’ll fit the model with process errors being estimated,
unequal variances by trend, and not z-score the data (this is just a
test of the scaling).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_dfa.html">fit_dfa</a></span><span class="op">(</span></span>
<span>  y <span class="op">=</span> <span class="va">sim_dat</span><span class="op">$</span><span class="va">y_sim</span>, num_trends <span class="op">=</span> <span class="fl">2</span>, scale<span class="op">=</span><span class="st">"center"</span>, estimate_process_sigma <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  equal_process_sigma <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  iter <span class="op">=</span> <span class="va">iter</span>, chains <span class="op">=</span> <span class="va">chains</span>, thin <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="va">r3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rotate_trends.html">rotate_trends</a></span><span class="op">(</span><span class="va">f3</span><span class="op">)</span></span></code></pre></div>
<p>Our fourth and fifth models will be the same as # 2 and # 3, but will
estimate a single variance for both trends.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_dfa.html">fit_dfa</a></span><span class="op">(</span></span>
<span>  y <span class="op">=</span> <span class="va">sim_dat</span><span class="op">$</span><span class="va">y_sim</span>, num_trends <span class="op">=</span> <span class="fl">2</span>, scale<span class="op">=</span><span class="st">"zscore"</span>, estimate_process_sigma <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  equal_process_sigma <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  iter <span class="op">=</span> <span class="va">iter</span>, chains <span class="op">=</span> <span class="va">chains</span>, thin <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="va">r4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rotate_trends.html">rotate_trends</a></span><span class="op">(</span><span class="va">f4</span><span class="op">)</span></span>
<span></span>
<span><span class="va">f5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_dfa.html">fit_dfa</a></span><span class="op">(</span></span>
<span>  y <span class="op">=</span> <span class="va">sim_dat</span><span class="op">$</span><span class="va">y_sim</span>, num_trends <span class="op">=</span> <span class="fl">2</span>, scale<span class="op">=</span><span class="st">"center"</span>, estimate_process_sigma <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  equal_process_sigma <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  iter <span class="op">=</span> <span class="va">iter</span>, chains <span class="op">=</span> <span class="va">chains</span>, thin <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="va">r5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rotate_trends.html">rotate_trends</a></span><span class="op">(</span><span class="va">f5</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="recovering-loadings">Recovering loadings<a class="anchor" aria-label="anchor" href="#recovering-loadings"></a>
</h3>
<p>As a reminder, let’s look at the loadings from the original
simulation model</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">$</span><span class="va">Z</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       [,1]  [,2]</span></span>
<span><span class="co">## [1,]  0.57  0.00</span></span>
<span><span class="co">## [2,] -0.14  0.33</span></span>
<span><span class="co">## [3,]  1.18  1.06</span></span>
<span><span class="co">## [4,] -1.52 -0.30</span></span></code></pre>
<p>The estimated loadings from the DFA where the trends are forced to
have the same fixed variance are good</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">r1</span><span class="op">$</span><span class="va">Z_rot_mean</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        [,1]    [,2]</span></span>
<span><span class="co">## [1,] -91.70  -32.20</span></span>
<span><span class="co">## [2,] -10.27 -109.07</span></span>
<span><span class="co">## [3,]  42.34  -12.66</span></span>
<span><span class="co">## [4,] -28.00   -7.90</span></span></code></pre>
<p>but some of the loadings are far off. These loadings are also not
well estimated for either of the models that estimate the process
variances,</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">r2</span><span class="op">$</span><span class="va">Z_rot_mean</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        [,1]    [,2]</span></span>
<span><span class="co">## [1,] -70.20   68.36</span></span>
<span><span class="co">## [2,] -14.61 -118.64</span></span>
<span><span class="co">## [3,] -66.64    9.32</span></span>
<span><span class="co">## [4,] -47.34  -10.62</span></span></code></pre>
<p>or</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">r3</span><span class="op">$</span><span class="va">Z_rot_mean</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         [,1]   [,2]</span></span>
<span><span class="co">## [1,]  -92.62  37.23</span></span>
<span><span class="co">## [2,] -100.07 -64.45</span></span>
<span><span class="co">## [3,]   -3.13 -44.88</span></span>
<span><span class="co">## [4,]  -83.12 -29.19</span></span></code></pre>
<p>The loadings for Model 4 are given by</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">r4</span><span class="op">$</span><span class="va">Z_rot_mean</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        [,1]   [,2]</span></span>
<span><span class="co">## [1,] -99.51   5.65</span></span>
<span><span class="co">## [2,]  -7.46 -98.49</span></span>
<span><span class="co">## [3,]   8.32   2.71</span></span>
<span><span class="co">## [4,]   1.16   0.06</span></span></code></pre>
<p>and Model 5 by</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">r5</span><span class="op">$</span><span class="va">Z_rot_mean</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        [,1]    [,2]</span></span>
<span><span class="co">## [1,] -89.54  -26.98</span></span>
<span><span class="co">## [2,] -19.58 -107.16</span></span>
<span><span class="co">## [3,]  44.17   66.35</span></span>
<span><span class="co">## [4,] -47.99  -90.43</span></span></code></pre>
<p>If we calculate the RMSE of the different models, model # 3
(estimated process trends, raw data not standardized) performs the
best</p>
<table class="table">
<thead><tr class="header">
<th align="right">Model</th>
<th align="right">RMSE-loadings</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">24263.24</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">30917.61</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">33873.93</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">19927.94</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">37172.58</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="recovering-trends">Recovering trends<a class="anchor" aria-label="anchor" href="#recovering-trends"></a>
</h3>
<p>Let’s do the same kind of summary with the trends</p>
<table class="table">
<thead><tr class="header">
<th align="right">Model</th>
<th align="right">RMSE-trends</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">321.8506</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">199.0063</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">311.6231</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">128.4473</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">320.6021</td>
</tr>
</tbody>
</table>
<p>These show that model 3 (trend variances are estimated, with data not
standardized) performs best</p>
</div>
<div class="section level3">
<h3 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h3>
<p>In this example, the estimation model that treated the variances of
the random walks as parameters performed better than models that didn’t.
A caveat is that we simulated the random walk variances to be an order
of magnitude difference between the 2 trends, more similar trends would
need additional simulations and more thorough validation studies.
Similarly, we found that not standardizing the raw time series data
(instead, just centering each time series) yielded estimates of the
loadings and estimated trends that were more similar to those in the
simulation model. Standardizing each time series a priori yields
slightly worse estimates of the trends and loadings (comparing models 2
v 3 and 4 v 5).</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Eric J. Ward, Sean C. Anderson, Luis A. Damiano, Michael J. Malick, Philina A. English.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
