<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Examples of including covariates with bayesdfa • bayesdfa</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Examples of including covariates with bayesdfa">
<meta property="og:description" content="bayesdfa">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bayesdfa</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/a1_bayesdfa.html">Overview of the bayesdfa package</a>
    </li>
    <li>
      <a href="../articles/a2_combining_data.html">Combining data with bayesdfa</a>
    </li>
    <li>
      <a href="../articles/a3_covariates.html">Examples of including covariates with bayesdfa</a>
    </li>
    <li>
      <a href="../articles/a4_smooth.html">Examples of fitting smooth trend DFA models</a>
    </li>
    <li>
      <a href="../articles/a5_estimate_process_sigma.html">Estimating process trend variability with bayesdfa</a>
    </li>
    <li>
      <a href="../articles/a6_compositional.html">Fitting compositional dynamic factor models with bayesdfa</a>
    </li>
    <li>
      <a href="../articles/a7_bigdata.html">Examples of fitting DFA models with lots of data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/fate-ewi/bayesdfa/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Examples of including covariates with
bayesdfa</h1>
                        <h4 data-toc-skip class="author">Eric J. Ward,
Sean C. Anderson, Mary E. Hunsicker, Mike A. Litzow, Luis A. Damiano,
Mark D. Scheuerell, Elizabeth E. Holmes, Nick Tolimieri</h4>
            
            <h4 data-toc-skip class="date">2023-04-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/fate-ewi/bayesdfa/blob/HEAD/vignettes/a3_covariates.Rmd" class="external-link"><code>vignettes/a3_covariates.Rmd</code></a></small>
      <div class="hidden name"><code>a3_covariates.Rmd</code></div>

    </div>

    
    
<p>Here we will walk through how to use the bayesdfa package to fit
dynamic factor analysis (DFA) models with covariates.</p>
<p>Let’s load the necessary packages:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://fate-ewi.github.io/bayesdfa/" class="external-link">bayesdfa</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/rstan/" class="external-link">rstan</a></span><span class="op">)</span></span>
<span><span class="va">chains</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="va">iter</span> <span class="op">=</span> <span class="fl">10</span></span></code></pre></div>
<div class="section level2">
<h2 id="notation-review-for-dfa-models">Notation review for DFA models<a class="anchor" aria-label="anchor" href="#notation-review-for-dfa-models"></a>
</h2>
<p>Covariates in dynamic factor analysis are generally included in the
observation model, rather than the process model. Without covariates,
the model can be expressed as</p>
<p><span class="math display">\[{x}_{t}={x}_{t-1}+{e}_t\\ { e }_{ t
}\sim MVN(0,\textbf{Q})\\ { y }_{ t }=\textbf{Z}{ x }_{ t }+{ v }_{ t
}\\ { v }_{ t }\sim MVN(0,\textbf{R})\]</span></p>
<p>where the matrix <span class="math inline">\(\textbf{Z}\)</span> is
dimensioned as the number of time series by number of trends, and maps
the observed data <span class="math inline">\(y_{t}\)</span> to the
latent trends <span class="math inline">\(x_{t}\)</span>.</p>
<div class="section level3">
<h3 id="observation-covariates">Observation covariates<a class="anchor" aria-label="anchor" href="#observation-covariates"></a>
</h3>
<p>Observation covariates can be <span class="math display">\[{x}_{t}={x}_{t-1}+{e}_t\\ { e }_{ t }\sim
MVN(0,\textbf{Q})\\ { y }_{ t }=\textbf{Z}{ x }_{ t }+\textbf{D}{ d }_{
t }+{ v }_{ t }\\ { v }_{ t }\sim MVN(0,\textbf{R})\]</span> where the
matrix <span class="math inline">\(\textbf{D}\)</span> represents time
series by number of covariates at time <span class="math inline">\(t\)</span>. For a single covariate, such as
temperature, this would mean estimating <span class="math inline">\(P\)</span> parameters, where <span class="math inline">\(P\)</span> is the number of time series. For a
model including 2 covariates, the number of estimated coefficients would
be <span class="math inline">\(2P\)</span> and so forth.</p>
</div>
<div class="section level3">
<h3 id="process-covariates">Process covariates<a class="anchor" aria-label="anchor" href="#process-covariates"></a>
</h3>
<p>Process covariates on the trends are less common but can be written
as <span class="math display">\[{x}_{t}={x}_{t-1}+\textbf{C}{ c }_{ t
}+{e}_t\\ { e }_{ t }\sim MVN(0,\textbf{Q})\\ { y }_{ t }=\textbf{Z}{ x
}_{ t }+{ v }_{ t }\\ { v }_{ t }\sim MVN(0,\textbf{R})\]</span> where
the matrix <span class="math inline">\(\textbf{C}\)</span> represents
the number of trends by number of covariates at time <span class="math inline">\(t\)</span>. For a single trend, this would mean
estimating <span class="math inline">\(K\)</span> parameters, where
<span class="math inline">\(K\)</span> is the number of trends. For a
model including 2 covariates, the number of estimated coefficients would
be <span class="math inline">\(2K\)</span> and so forth.</p>
</div>
</div>
<div class="section level2">
<h2 id="examples-observation-covariates">Examples – observation covariates<a class="anchor" aria-label="anchor" href="#examples-observation-covariates"></a>
</h2>
<p>We’ll start by simulating some random trends using the
<code>sim_dat</code> function,</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">sim_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_dfa.html">sim_dfa</a></span><span class="op">(</span></span>
<span>  num_trends <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  num_years <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  num_ts <span class="op">=</span> <span class="fl">4</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Next, we can add a covariate effect to the trend estimate,
<code>x</code>. For example,</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cov</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span><span class="st">"time"</span><span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, <span class="st">"timeseries"</span><span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="st">"covariate"</span><span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">cov</span><span class="op">$</span><span class="va">value</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">cov</span><span class="op">)</span>,<span class="fl">0</span>,<span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">cov</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">sim_dat</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="va">cov</span><span class="op">$</span><span class="va">timeseries</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="va">cov</span><span class="op">$</span><span class="va">time</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="va">sim_dat</span><span class="op">$</span><span class="va">pred</span><span class="op">[</span><span class="va">cov</span><span class="op">$</span><span class="va">timeseries</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="va">cov</span><span class="op">$</span><span class="va">time</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.2</span>,<span class="fl">0.3</span>,<span class="fl">0.4</span><span class="op">)</span><span class="op">[</span><span class="va">cov</span><span class="op">$</span><span class="va">timeseries</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">*</span><span class="va">cov</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>And now fit the model with <code>fit_dfa</code></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_dfa.html">fit_dfa</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">sim_dat</span><span class="op">$</span><span class="va">y</span>, obs_covar <span class="op">=</span> <span class="va">cov</span>, num_trends <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  chains<span class="op">=</span><span class="va">chains</span>, iter<span class="op">=</span><span class="va">iter</span><span class="op">)</span></span></code></pre></div>
<p>We can then make plots of the true and estimated trend,</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>, xlab<span class="op">=</span><span class="st">"Time"</span>, ylab<span class="op">=</span><span class="st">"True trend"</span><span class="op">)</span></span></code></pre></div>
<p><img src="a3_covariates_files/figure-html/unnamed-chunk-4-1.png" width="528"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_trends.html">plot_trends</a></span><span class="op">(</span><span class="fu"><a href="../reference/rotate_trends.html">rotate_trends</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Estimated trend"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="a3_covariates_files/figure-html/unnamed-chunk-5-1.png" width="528"></p>
<p>This approach could be modified to have covariates not affecting some
time series. For example, if we didn’t want the covariate to affect the
last time series, we could say</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cov</span> <span class="op">=</span> <span class="va">cov</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">cov</span><span class="op">$</span><span class="va">timeseries</span><span class="op">!=</span><span class="fl">4</span><span class="op">)</span>,<span class="op">]</span></span></code></pre></div>
<p>And then again fit the model</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_dfa.html">fit_dfa</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">sim_dat</span><span class="op">$</span><span class="va">y</span>, obs_covar <span class="op">=</span> <span class="va">cov</span>, num_trends <span class="op">=</span> <span class="va">trends</span>,</span>
<span>  chains<span class="op">=</span><span class="va">chains</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="examples-process-covariates">Examples – process covariates<a class="anchor" aria-label="anchor" href="#examples-process-covariates"></a>
</h2>
<p>As a cautionary note, there’s some identifiability issues with
including covariates in the process model. Covariates need to be
standardized or centered prior to being included. Future versions of
this vignette will include more clear examples and recommendations.</p>
<p>We’ll start by simulating some random trends using the
<code>sim_dat</code> function,</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">sim_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_dfa.html">sim_dfa</a></span><span class="op">(</span></span>
<span>  num_trends <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  num_years <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  num_ts <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Next, we can add a covariate effect to the trend estimate,
<code>x</code>. For example,</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cov</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">b_pro</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">2</span>,<span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="va">i</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="va">cov</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">b_pro</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cov</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="fl">1</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span>,<span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">cov</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">*</span><span class="va">b_pro</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="fl">2</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span>,<span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">cov</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">*</span><span class="va">b_pro</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">y</span> <span class="op">=</span> <span class="va">sim_dat</span><span class="op">$</span><span class="va">Z</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">x</span></span></code></pre></div>
<p>And now fit the model with <code>fit_dfa</code></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pro_cov</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span><span class="st">"trend"</span><span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="st">"time"</span><span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, <span class="st">"covariate"</span><span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">pro_cov</span><span class="op">$</span><span class="va">value</span> <span class="op">=</span> <span class="va">cov</span><span class="op">[</span><span class="va">pro_cov</span><span class="op">$</span><span class="va">time</span><span class="op">]</span></span>
<span></span>
<span><span class="va">mod</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_dfa.html">fit_dfa</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">sim_dat</span><span class="op">$</span><span class="va">y</span>, pro_covar <span class="op">=</span> <span class="va">pro_cov</span>, num_trends <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  chains<span class="op">=</span><span class="va">chains</span>, iter<span class="op">=</span><span class="va">iter</span><span class="op">)</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Eric J. Ward, Sean C. Anderson, Luis A. Damiano, Michael J. Malick.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
