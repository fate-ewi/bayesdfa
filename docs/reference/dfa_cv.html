<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Apply cross validation to DFA model — dfa_cv • bayesdfa</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Apply cross validation to DFA model — dfa_cv"><meta property="og:description" content="Apply cross validation to DFA model"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bayesdfa</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.3.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/a1_bayesdfa.html">Overview of the bayesdfa package</a>
    </li>
    <li>
      <a href="../articles/a2_combining_data.html">Combining data with bayesdfa</a>
    </li>
    <li>
      <a href="../articles/a3_covariates.html">Examples of including covariates with bayesdfa</a>
    </li>
    <li>
      <a href="../articles/a4_smooth.html">Examples of fitting smooth trend DFA models</a>
    </li>
    <li>
      <a href="../articles/a5_estimate_process_sigma.html">Estimating process trend variability with bayesdfa</a>
    </li>
    <li>
      <a href="../articles/a6_compositional.html">Fitting compositional dynamic factor models with bayesdfa</a>
    </li>
    <li>
      <a href="../articles/a7_bigdata.html">Examples of fitting DFA models with lots of data</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/fate-ewi/bayesdfa/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Apply cross validation to DFA model</h1>
    <small class="dont-index">Source: <a href="https://github.com/fate-ewi/bayesdfa/blob/HEAD/R/dfa_cv.R" class="external-link"><code>R/dfa_cv.R</code></a></small>
    <div class="hidden name"><code>dfa_cv.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Apply cross validation to DFA model</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">dfa_cv</span><span class="op">(</span></span>
<span>  <span class="va">stanfit</span>,</span>
<span>  cv_method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"loocv"</span>, <span class="st">"lfocv"</span><span class="op">)</span>,</span>
<span>  fold_ids <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_folds <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  estimation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sampling"</span>, <span class="st">"optimizing"</span>, <span class="st">"vb"</span><span class="op">)</span>,</span>
<span>  iter <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  thin <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>stanfit</dt>
<dd><p>A stanfit object, to preserve the model structure from a call to fit_dfa()</p></dd>


<dt>cv_method</dt>
<dd><p>The method used for cross validation. The options are 'loocv', where time is ignored and each data point is
assigned randomly to a fold. The method 'ltocv' is leave time out cross validation, and time slices are iteratively held out
out. Finally the method 'lfocv' implements leave future out cross validation to do one-step ahead predictions.</p></dd>


<dt>fold_ids</dt>
<dd><p>A vector whose length is the same as the number of total data points. Elements are the fold id of each data point. If not all data points are
used (e.g. the lfocv or ltocv approach might only use 10 time steps) the value can be something other than a numbber,
e.g. NA</p></dd>


<dt>n_folds</dt>
<dd><p>Number of folds, defaults to 10</p></dd>


<dt>estimation</dt>
<dd><p>Character string. Should the model be sampled using <code><a href="https://mc-stan.org/rstan/reference/stanmodel-method-sampling.html" class="external-link">rstan::sampling()</a></code> ("sampling",default),
<code><a href="https://mc-stan.org/rstan/reference/stanmodel-method-optimizing.html" class="external-link">rstan::optimizing()</a></code> ("optimizing"), variational inference <code><a href="https://mc-stan.org/rstan/reference/stanmodel-method-vb.html" class="external-link">rstan::vb()</a></code> ("vb").</p></dd>


<dt>iter</dt>
<dd><p>Number of iterations in Stan sampling, defaults to 2000.</p></dd>


<dt>chains</dt>
<dd><p>Number of chains in Stan sampling, defaults to 4.</p></dd>


<dt>thin</dt>
<dd><p>Thinning rate in Stan sampling, defaults to 1.</p></dd>


<dt>...</dt>
<dd><p>Any other arguments to pass to <code><a href="https://mc-stan.org/rstan/reference/stanmodel-method-sampling.html" class="external-link">rstan::sampling()</a></code>.</p></dd>

</dl></div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim_dfa.html">sim_dfa</a></span><span class="op">(</span>num_trends <span class="op">=</span> <span class="fl">1</span>, num_years <span class="op">=</span> <span class="fl">20</span>, num_ts <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">s</span><span class="op">$</span><span class="va">y_sim</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span>, <span class="va">s</span><span class="op">$</span><span class="va">y_sim</span><span class="op">[</span><span class="fl">2</span>, <span class="op">]</span>, <span class="va">s</span><span class="op">$</span><span class="va">y_sim</span><span class="op">[</span><span class="fl">3</span>, <span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"obs"</span> <span class="op">=</span> <span class="va">obs</span>, <span class="st">"ts"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span><span class="st">"time"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="fit_dfa.html">fit_dfa</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">long</span>, data_shape <span class="op">=</span> <span class="st">"long"</span>, estimation<span class="op">=</span><span class="st">"none"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># random folds</span></span></span>
<span class="r-in"><span><span class="va">fit_cv</span> <span class="op">&lt;-</span> <span class="fu">dfa_cv</span><span class="op">(</span><span class="va">m</span>, cv_method <span class="op">=</span> <span class="st">"loocv"</span>, n_folds <span class="op">=</span> <span class="fl">5</span>, iter <span class="op">=</span> <span class="fl">50</span>,</span></span>
<span class="r-in"><span>chains <span class="op">=</span> <span class="fl">1</span>, estimation<span class="op">=</span><span class="st">"sampling"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># folds can also be passed in</span></span></span>
<span class="r-in"><span><span class="va">fold_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">long</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="fit_dfa.html">fit_dfa</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">long</span>, data_shape <span class="op">=</span> <span class="st">"long"</span>, estimation<span class="op">=</span><span class="st">"none"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit_cv</span> <span class="op">&lt;-</span> <span class="fu">dfa_cv</span><span class="op">(</span><span class="va">m</span>, cv_method <span class="op">=</span> <span class="st">"loocv"</span>, n_folds <span class="op">=</span> <span class="fl">5</span>, iter <span class="op">=</span> <span class="fl">50</span>, chains <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>fold_ids <span class="op">=</span> <span class="va">fold_ids</span>, estimation<span class="op">=</span><span class="st">"sampling"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># do an example of leave-time-out cross validation where years are dropped</span></span></span>
<span class="r-in"><span><span class="va">fold_ids</span> <span class="op">&lt;-</span> <span class="va">long</span><span class="op">$</span><span class="va">time</span></span></span>
<span class="r-in"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="fit_dfa.html">fit_dfa</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">long</span>, data_shape <span class="op">=</span> <span class="st">"long"</span>, estimation<span class="op">=</span><span class="st">"none"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit_cv</span> <span class="op">&lt;-</span> <span class="fu">dfa_cv</span><span class="op">(</span><span class="va">m</span>, cv_method <span class="op">=</span> <span class="st">"loocv"</span>, iter <span class="op">=</span> <span class="fl">100</span>, chains <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>fold_ids <span class="op">=</span> <span class="va">fold_ids</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># example with covariates and long format data</span></span></span>
<span class="r-in"><span><span class="va">obs_covar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span><span class="st">"time"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, <span class="st">"timeseries"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,</span></span>
<span class="r-in"><span><span class="st">"covariate"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">obs_covar</span><span class="op">$</span><span class="va">value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">obs_covar</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">s</span><span class="op">$</span><span class="va">y_sim</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span>, <span class="va">s</span><span class="op">$</span><span class="va">y_sim</span><span class="op">[</span><span class="fl">2</span>, <span class="op">]</span>, <span class="va">s</span><span class="op">$</span><span class="va">y_sim</span><span class="op">[</span><span class="fl">3</span>, <span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="fit_dfa.html">fit_dfa</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">long</span>, obs_covar <span class="op">=</span> <span class="va">obs_covar</span>,</span></span>
<span class="r-in"><span>data_shape <span class="op">=</span> <span class="st">"long"</span>, estimation<span class="op">=</span><span class="st">"none"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit_cv</span> <span class="op">&lt;-</span> <span class="fu">dfa_cv</span><span class="op">(</span><span class="va">m</span>, cv_method <span class="op">=</span> <span class="st">"loocv"</span>, n_folds <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>iter <span class="op">=</span> <span class="fl">50</span>, chains <span class="op">=</span> <span class="fl">1</span>, estimation<span class="op">=</span><span class="st">"sampling"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Eric J. Ward, Sean C. Anderson, Luis A. Damiano, Michael J. Malick, Philina A. English.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer></div>

  


  

  </body></html>

